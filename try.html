<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTG Inventory</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .inventory-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Adjust for larger size */
            gap: 20px;
        }
        .card-item {
            position: relative;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
            overflow: hidden;
            height: auto;
        }
        .card-item:hover {
            transform: translateY(-5px);
        }
        .card-image {
            width: 100%;
            height: 350px; /* Increased height for better readability */
            object-fit: contain; /* Ensure the entire image is visible */
            border-radius: 4px;
            display: block;
            position: relative;
            z-index: 1;
        }
        .quantity-box {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent background */
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 3;
        }
        .foil-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);
            opacity: 0.3; /* Adjusted for better readability */
            z-index: 2;
            pointer-events: none;
            border-radius: 4px;
        }
        .pagination {
            margin-top: 20px;
            text-align: center;
            display: none; /* Hide initially */
        }
        .pagination button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 10; /* Ensure it stays on top */
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            z-index: 11; /* Modal content should be on top of everything */
        }
        .close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            z-index: 12;
        }
    </style>
</head>
<body>

<h2>MTG Inventory</h2>
<div class="inventory-container" id="inventory">
    <!-- Placeholder for inventory items -->
</div>

<div class="pagination" id="paginationControls">
    <button id="prevPage">Previous</button>
    <span id="pageInfo"></span>
    <button id="nextPage">Next</button>
</div>

<!-- Modal for Card Details -->
<div class="modal" id="cardModal">
    <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2 id="modalCardName"></h2>
        <img id="modalCardImage" src="" alt="Card Image" style="width: 100%; max-width: 400px;">
        <p id="modalCardSet"></p>
        <p id="modalCardQuantity"></p>
        <p id="modalCardFoil"></p>
    </div>
</div>

<script>
    let inventory = [];
    let currentPage = 1;
    const entriesPerPage = 50; // Display 50 entries per page

    document.addEventListener('DOMContentLoaded', function() {
        fetch('./collection.csv')
            .then(response => response.text())
            .then(data => {
                parseCSV(data);
            });
    });

    function parseCSV(contents) {
        const rows = contents.split('\n').slice(1); // Split into rows and skip header
        inventory = rows.map(row => {
            const columns = row.split(',');
            return {
                name: columns[2].trim(),                // Column C: Name
                setCode: columns[3].trim(),             // Column D: Set Code
                collectorNumber: columns[5].trim(),     // Column F: Collector Number
                foil: columns[6].trim().toLowerCase() === 'foil', // Column G: Foil (converted to boolean)
                quantity: parseInt(columns[8].trim()),  // Column I: Quantity
                scryfallId: columns[10].trim()          // Column K: Scryfall ID
            };
        });

        document.getElementById('paginationControls').style.display = 'block'; // Show pagination controls
        displayPage(currentPage);
        updatePageInfo();
    }

    function fetchCardData(card) {
        fetch(`https://api.scryfall.com/cards/${card.scryfallId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('modalCardName').textContent = data.name;
                document.getElementById('modalCardImage').src = data.image_uris.normal;
                document.getElementById('modalCardSet').textContent = `Set: ${data.set_name}`;
                document.getElementById('modalCardQuantity').textContent = `Quantity: ${card.quantity}`;
                document.getElementById('modalCardFoil').textContent = `Foil: ${card.foil ? "Yes" : "No"}`;
                document.getElementById('cardModal').style.display = 'flex';
            });
    }

    function closeModal() {
        document.getElementById('cardModal').style.display = "none";
    }

    // Close modal by clicking outside the content
    document.getElementById('cardModal').addEventListener('click', function(event) {
        if (event.target === this) {
            closeModal();
        }
    });

    document.getElementById('closeModal').addEventListener('click', closeModal);

    function displayPage(page) {
        const inventoryContainer = document.getElementById('inventory');
        inventoryContainer.innerHTML = ''; // Clear previous content

        const startIndex = (page - 1) * entriesPerPage;
        const endIndex = startIndex + entriesPerPage;
        const pageEntries = inventory.slice(startIndex, endIndex);

        pageEntries.forEach(card => {
            fetch(`https://api.scryfall.com/cards/${card.scryfallId}`)
                .then(response => response.json())
                .then(data => {
                    const cardItem = document.createElement('div');
                    cardItem.className = 'card-item';

                    const image = document.createElement('img');
                    image.src = data.image_uris.normal; // Use the normal size image for better quality
                    image.alt = card.name;
                    image.className = 'card-image';

                    cardItem.appendChild(image);

                    if (card.foil) {
                        const foilOverlay = document.createElement('div');
                        foilOverlay.className = 'foil-overlay';
                        cardItem.appendChild(foilOverlay);
                    }

                    const quantityBox = document.createElement('div');
                    quantityBox.className = 'quantity-box';
                    quantityBox.textContent = `x${card.quantity}`;
                    cardItem.appendChild(quantityBox);

                    cardItem.addEventListener('click', () => fetchCardData(card));
                    inventoryContainer.appendChild(cardItem);
                });
        });
    }

    function updatePageInfo() {
        const totalPages = Math.ceil(inventory.length / entriesPerPage);
        document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;

        document.getElementById('prevPage').disabled = currentPage === 1;
        document.getElementById('nextPage').disabled = currentPage === totalPages;
    }

    document.getElementById('prevPage').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            displayPage(currentPage);
            updatePageInfo();
        }
    });

    document.getElementById('nextPage').addEventListener('click', () => {
        const totalPages = Math.ceil(inventory.length / entriesPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            displayPage(currentPage);
            updatePageInfo();
        }
    });

</script>

</body>
</html>